```html
<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zadania Szachowe Pro - Trenuj Taktykƒô</title>

<style>
:root {
  --board-light: #f0d9b5;
  --board-dark: #b58863;
  --primary: #81b64c;
  --primary-hover: #72a744;
  --secondary: #7fa650;
  --accent: #ca3c3d;
  --text-dark: #312e2b;
  --text-light: #fff;
  --bg-light: #f7f7f7;
  --bg-white: #ffffff;
  --border: #dddddd;
  --success: #81b64c;
  --error: #ca3c3d;
  --warning: #f0ad4e;
  --info: #5bc0de;
  --highlight: rgba(255, 255, 0, 0.5);
  --move-highlight: rgba(155, 199, 0, 0.4);
  --shadow: 0 2px 10px rgba(0,0,0,0.1);
  --shadow-lg: 0 4px 20px rgba(0,0,0,0.15);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: var(--bg-light);
  color: var(--text-dark);
  line-height: 1.6;
  overflow-x: hidden;
}

/* Header */
.header {
  background: var(--text-dark);
  color: var(--text-light);
  padding: 0;
  box-shadow: var(--shadow-lg);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
}

.logo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.5rem;
  font-weight: 700;
  text-decoration: none;
  color: var(--text-light);
}

.logo-icon {
  font-size: 2rem;
}

.nav {
  display: flex;
  gap: 2rem;
  align-items: center;
}

.nav-link {
  color: var(--text-light);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s;
  padding: 0.5rem 0;
  border-bottom: 2px solid transparent;
}

.nav-link:hover {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

.user-stats {
  display: flex;
  gap: 1.5rem;
  align-items: center;
  font-size: 0.9rem;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.stat-icon {
  font-size: 1.2rem;
}

/* Main Container */
.main-container {
  max-width: 1400px;
  margin: 2rem auto;
  padding: 0 2rem;
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: 2rem;
}

/* Board Section */
.board-section {
  background: var(--bg-white);
  border-radius: 12px;
  padding: 2rem;
  box-shadow: var(--shadow);
}

.puzzle-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
}

.puzzle-title {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.puzzle-title h1 {
  font-size: 1.75rem;
  color: var(--text-dark);
}

.puzzle-meta {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.difficulty-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0.9rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  text-transform: uppercase;
}

.difficulty-badge.easy {
  background: #d4edda;
  color: #155724;
}

.difficulty-badge.medium {
  background: #fff3cd;
  color: #856404;
}

.difficulty-badge.hard {
  background: #f8d7da;
  color: #721c24;
}

.difficulty-badge.expert {
  background: #d1ecf1;
  color: #0c5460;
}

.rating-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.4rem 0.9rem;
  background: var(--primary);
  color: white;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
}

.puzzle-info {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.timer {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-dark);
  padding: 0.5rem 1rem;
  background: var(--bg-light);
  border-radius: 8px;
}

.moves-count {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: var(--bg-light);
  border-radius: 8px;
  font-weight: 600;
}

/* Chess Board */
.board-container {
  display: flex;
  justify-content: center;
  margin: 2rem 0;
  position: relative;
}

.board-wrapper {
  position: relative;
  display: inline-block;
}

.coordinates {
  position: absolute;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-dark);
  user-select: none;
}

.file-coords {
  display: flex;
  justify-content: space-around;
  width: 100%;
  position: absolute;
  bottom: -25px;
  left: 0;
}

.rank-coords {
  position: absolute;
  left: -25px;
  top: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  align-items: center;
}

.board {
  display: grid;
  grid-template-columns: repeat(8, 70px);
  grid-template-rows: repeat(8, 70px);
  border: 3px solid var(--text-dark);
  box-shadow: var(--shadow-lg);
  position: relative;
}

.square {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.square.light {
  background: var(--board-light);
}

.square.dark {
  background: var(--board-dark);
}

.square.selected {
  box-shadow: inset 0 0 0 3px var(--primary);
  z-index: 10;
}

.square.legal-move::after {
  content: '';
  position: absolute;
  width: 25%;
  height: 25%;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 50%;
  pointer-events: none;
}

.square.legal-capture::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  border: 4px solid rgba(0, 0, 0, 0.2);
  border-radius: 50%;
  pointer-events: none;
}

.square.last-move {
  background-color: var(--move-highlight) !important;
}

.square.check {
  background: radial-gradient(circle, var(--accent) 0%, transparent 70%) !important;
}

.square:hover {
  opacity: 0.9;
}

.piece {
  font-size: 56px;
  cursor: grab;
  user-select: none;
  transition: transform 0.1s ease;
  filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
}

.piece:active {
  cursor: grabbing;
  transform: scale(1.1);
}

.piece.dragging {
  opacity: 0.5;
}

.square-label {
  position: absolute;
  font-size: 0.7rem;
  font-weight: 600;
  pointer-events: none;
}

.square-label.file {
  bottom: 2px;
  right: 3px;
}

.square-label.rank {
  top: 2px;
  left: 3px;
}

.square.light .square-label {
  color: var(--board-dark);
}

.square.dark .square-label {
  color: var(--board-light);
}

/* Control Panel */
.controls {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  flex-wrap: wrap;
  justify-content: center;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  color: white;
  box-shadow: var(--shadow);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn:active {
  transform: translateY(0);
}

.btn-primary {
  background: var(--primary);
}

.btn-primary:hover {
  background: var(--primary-hover);
}

.btn-secondary {
  background: #6c757d;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-success {
  background: var(--success);
}

.btn-danger {
  background: var(--accent);
}

.btn-info {
  background: var(--info);
}

.btn-icon {
  font-size: 1.2rem;
}

/* Sidebar */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.panel {
  background: var(--bg-white);
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.panel-header {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: var(--text-dark);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.panel-icon {
  font-size: 1.4rem;
}

/* Progress Panel */
.progress-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.progress-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.progress-label {
  font-weight: 600;
  color: var(--text-dark);
}

.progress-value {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--primary);
}

.progress-bar-container {
  width: 100%;
  height: 8px;
  background: var(--bg-light);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 0.5rem;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  transition: width 0.5s ease;
  border-radius: 10px;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.stat-card {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
}

.stat-label {
  font-size: 0.85rem;
  color: #666;
  margin-top: 0.25rem;
}

/* Moves List */
.moves-list {
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.5rem;
}

.move-item {
  display: flex;
  align-items: center;
  padding: 0.5rem;
  border-radius: 6px;
  margin-bottom: 0.25rem;
  cursor: pointer;
  transition: background 0.2s;
}

.move-item:hover {
  background: var(--bg-light);
}

.move-number {
  font-weight: 700;
  min-width: 40px;
  color: #666;
}

.move-notation {
  font-family: 'Courier New', monospace;
  font-weight: 600;
}

/* Hint Panel */
.hint-content {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 8px;
  border-left: 4px solid var(--info);
  margin-top: 1rem;
  display: none;
}

.hint-content.visible {
  display: block;
}

.hint-text {
  color: var(--text-dark);
  line-height: 1.6;
}

/* Solution Panel */
.solution-panel {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  border-left: 4px solid var(--success);
  padding: 1.5rem;
  border-radius: 8px;
  display: none;
}

.solution-panel.visible {
  display: block;
}

.solution-header {
  font-size: 1.2rem;
  font-weight: 700;
  color: #155724;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.solution-moves {
  background: white;
  padding: 1rem;
  border-radius: 6px;
  margin: 1rem 0;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: var(--text-dark);
}

.solution-explanation {
  color: #155724;
  line-height: 1.8;
}

/* Feedback Messages */
.feedback {
  position: fixed;
  top: 80px;
  right: 20px;
  padding: 1rem 1.5rem;
  border-radius: 8px;
  font-weight: 600;
  box-shadow: var(--shadow-lg);
  display: none;
  align-items: center;
  gap: 0.75rem;
  z-index: 1001;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.feedback.visible {
  display: flex;
}

.feedback.success {
  background: var(--success);
  color: white;
}

.feedback.error {
  background: var(--accent);
  color: white;
}

.feedback.info {
  background: var(--info);
  color: white;
}

.feedback-icon {
  font-size: 1.5rem;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.modal.visible {
  display: flex;
}

.modal-content {
  background: var(--bg-white);
  padding: 2.5rem;
  border-radius: 16px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  text-align: center;
  animation: modalPop 0.3s ease;
}

@keyframes modalPop {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.modal-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.modal-title {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: var(--text-dark);
}

.modal-message {
  font-size: 1.1rem;
  margin-bottom: 1.5rem;
  color: #666;
  line-height: 1.6;
}

.modal-stats {
  background: var(--bg-light);
  padding: 1.5rem;
  border-radius: 8px;
  margin: 1.5rem 0;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.modal-stat {
  text-align: center;
}

.modal-stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
}

.modal-stat-label {
  font-size: 0.85rem;
  color: #666;
  margin-top: 0.25rem;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-top: 2rem;
}

/* Puzzle Navigation */
.puzzle-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 2px solid var(--border);
}

.puzzle-counter {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-dark);
}

/* Themes */
.theme-selector {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 8px;
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.theme-option {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  cursor: pointer;
  border: 3px solid transparent;
  transition: all 0.2s;
}

.theme-option:hover {
  transform: scale(1.1);
}

.theme-option.active {
  border-color: var(--primary);
  box-shadow: 0 0 0 2px var(--bg-white);
}

.theme-classic {
  background: linear-gradient(135deg, #f0d9b5 50%, #b58863 50%);
}

.theme-blue {
  background: linear-gradient(135deg, #dee3e6 50%, #8ca2ad 50%);
}

.theme-green {
  background: linear-gradient(135deg, #ffffdd 50%, #86a666 50%);
}

.theme-brown {
  background: linear-gradient(135deg, #f0dab5 50%, #946f51 50%);
}

/* Settings Panel */
.settings-group {
  margin-bottom: 1.5rem;
}

.settings-label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
  color: var(--text-dark);
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
  border-radius: 26px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--primary);
}

input:checked + .slider:before {
  transform: translateX(24px);
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--border);
}

.setting-item:last-child {
  border-bottom: none;
}

/* Responsive */
@media (max-width: 1200px) {
  .main-container {
    grid-template-columns: 1fr;
  }
  
  .sidebar {
    order: -1;
  }
}

@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    gap: 1rem;
  }
  
  .nav {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .board {
    grid-template-columns: repeat(8, 50px);
    grid-template-rows: repeat(8, 50px);
  }
  
  .piece {
    font-size: 40px;
  }
  
  .main-container {
    padding: 0 1rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .modal-stats {
    grid-template-columns: 1fr;
  }
}

/* Loading Spinner */
.spinner {
  border: 4px solid var(--bg-light);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 2rem auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-light);
}

::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-hover);
}

/* Animations */
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.bounce {
  animation: bounce 0.5s ease;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

.shake {
  animation: shake 0.5s ease;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.pulse {
  animation: pulse 0.5s ease;
}

/* Streak Counter */
.streak-display {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: linear-gradient(135deg, #ff6b6b, #feca57);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: 700;
}

.streak-icon {
  font-size: 1.2rem;
  animation: pulse 2s infinite;
}

/* Leaderboard */
.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.leaderboard-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  background: var(--bg-light);
  border-radius: 8px;
  transition: transform 0.2s;
}

.leaderboard-item:hover {
  transform: translateX(5px);
}

.leaderboard-rank {
  font-size: 1.2rem;
  font-weight: 700;
  min-width: 30px;
  text-align: center;
}

.leaderboard-rank.gold { color: #ffd700; }
.leaderboard-rank.silver { color: #c0c0c0; }
.leaderboard-rank.bronze { color: #cd7f32; }

.leaderboard-name {
  flex: 1;
  font-weight: 600;
}

.leaderboard-score {
  font-weight: 700;
  color: var(--primary);
}

/* Achievement Badges */
.achievements {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 1rem;
}

.achievement {
  text-align: center;
  padding: 1rem;
  background: var(--bg-light);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  opacity: 0.5;
}

.achievement.unlocked {
  opacity: 1;
  background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
}

.achievement:hover {
  transform: scale(1.05);
}

.achievement-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.achievement-name {
  font-size: 0.75rem;
  font-weight: 600;
}

/* Tooltip */
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  background-color: var(--text-dark);
  color: white;
  text-align: center;
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
  position: absolute;
  z-index: 1001;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
  white-space: nowrap;
  font-size: 0.85rem;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

/* Rating Change Indicator */
.rating-change {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  font-weight: 700;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.9rem;
}

.rating-change.positive {
  color: var(--success);
  background: rgba(129, 182, 76, 0.1);
}

.rating-change.negative {
  color: var(--accent);
  background: rgba(202, 60, 61, 0.1);
}

/* Combo Counter */
.combo-display {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 4rem;
  font-weight: 900;
  color: var(--primary);
  text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
  z-index: 1500;
  pointer-events: none;
  animation: comboPop 0.5s ease;
  display: none;
}

.combo-display.visible {
  display: block;
}

@keyframes comboPop {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0;
  }
}

/* Theme Variables - Blue Theme */
body.theme-blue {
  --board-light: #dee3e6;
  --board-dark: #8ca2ad;
}

body.theme-green {
  --board-light: #ffffdd;
  --board-dark: #86a666;
}

body.theme-brown {
  --board-light: #f0dab5;
  --board-dark: #946f51;
}

/* Puzzle Categories */
.category-filters {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-bottom: 1rem;
}

.category-btn {
  padding: 0.5rem 1rem;
  background: var(--bg-light);
  border: 2px solid var(--border);
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  color: var(--text-dark);
}

.category
```html
-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.category-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* Puzzle Tags */
.puzzle-tags {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-top: 1rem;
}

.tag {
  padding: 0.3rem 0.8rem;
  background: var(--bg-light);
  border-radius: 15px;
  font-size: 0.8rem;
  font-weight: 600;
  color: #666;
}

.tag.fork { background: #ffe5e5; color: #c92a2a; }
.tag.pin { background: #e5f4ff; color: #1971c2; }
.tag.skewer { background: #f3f0ff; color: #5f3dc4; }
.tag.discovered-attack { background: #fff4e6; color: #e67700; }
.tag.double-attack { background: #e7f5ff; color: #1864ab; }
.tag.mate { background: #d3f9d8; color: #2b8a3e; }
.tag.endgame { background: #fff5f5; color: #c92a2a; }
.tag.opening { background: #f8f0fc; color: #862e9c; }
.tag.middlegame { background: #fff9db; color: #e67700; }

/* Performance Chart */
.chart-container {
  width: 100%;
  height: 200px;
  margin-top: 1rem;
  position: relative;
}

.chart-bar {
  display: inline-block;
  width: 8%;
  background: var(--primary);
  margin: 0 1%;
  border-radius: 4px 4px 0 0;
  position: relative;
  transition: all 0.3s;
  cursor: pointer;
}

.chart-bar:hover {
  background: var(--primary-hover);
  transform: scaleY(1.05);
}

.chart-label {
  position: absolute;
  bottom: -25px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  color: #666;
}

.chart-value {
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--text-dark);
}

/* Daily Challenge Banner */
.daily-challenge {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow-lg);
}

.daily-challenge-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.daily-challenge-title {
  font-size: 1.3rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.daily-challenge-timer {
  font-size: 0.9rem;
  background: rgba(255,255,255,0.2);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: 600;
}

.daily-challenge-reward {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
}

/* Notification Badge */
.badge {
  background: var(--accent);
  color: white;
  border-radius: 10px;
  padding: 0.2rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 700;
  display: inline-block;
  margin-left: 0.5rem;
}

/* Sound Toggle */
.sound-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary);
  color: white;
  border: none;
  cursor: pointer;
  font-size: 1.5rem;
  box-shadow: var(--shadow-lg);
  transition: all 0.3s;
  z-index: 999;
}

.sound-toggle:hover {
  transform: scale(1.1);
}

.sound-toggle.muted {
  background: #6c757d;
}

/* Puzzle Difficulty Meter */
.difficulty-meter {
  display: flex;
  gap: 0.25rem;
  align-items: center;
}

.difficulty-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #ddd;
}

.difficulty-dot.filled.easy {
  background: #28a745;
}

.difficulty-dot.filled.medium {
  background: #ffc107;
}

.difficulty-dot.filled.hard {
  background: #fd7e14;
}

.difficulty-dot.filled.expert {
  background: #dc3545;
}

/* Move History Timeline */
.move-timeline {
  position: relative;
  padding-left: 2rem;
}

.move-timeline-item {
  position: relative;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  background: var(--bg-light);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.move-timeline-item:hover {
  background: var(--primary);
  color: white;
}

.move-timeline-item::before {
  content: '';
  position: absolute;
  left: -2rem;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  background: var(--primary);
  border-radius: 50%;
  border: 3px solid white;
  box-shadow: 0 0 0 2px var(--primary);
}

.move-timeline-item.current::before {
  background: var(--accent);
  box-shadow: 0 0 0 2px var(--accent);
}

.move-timeline::after {
  content: '';
  position: absolute;
  left: -1.45rem;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--border);
}

/* Hint Cost Display */
.hint-cost {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  color: #ffc107;
  font-weight: 600;
  font-size: 0.9rem;
}

/* Accuracy Indicator */
.accuracy-ring {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: conic-gradient(var(--primary) 0% var(--accuracy-percent), #ddd var(--accuracy-percent) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.accuracy-ring::before {
  content: '';
  position: absolute;
  width: 45px;
  height: 45px;
  background: white;
  border-radius: 50%;
}

.accuracy-value {
  position: relative;
  z-index: 1;
  font-weight: 700;
  font-size: 0.9rem;
}

/* Filter Dropdown */
.filter-dropdown {
  position: relative;
  display: inline-block;
}

.filter-btn {
  background: white;
  border: 2px solid var(--border);
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  transition: all 0.3s;
}

.filter-btn:hover {
  border-color: var(--primary);
  color: var(--primary);
}

.filter-menu {
  position: absolute;
  top: 100%;
  left: 0;
  margin-top: 0.5rem;
  background: white;
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: var(--shadow-lg);
  min-width: 200px;
  display: none;
  z-index: 100;
}

.filter-menu.visible {
  display: block;
}

.filter-option {
  padding: 0.75rem 1rem;
  cursor: pointer;
  transition: background 0.2s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.filter-option:hover {
  background: var(--bg-light);
}

.filter-option input[type="checkbox"] {
  cursor: pointer;
}

/* Practice Mode Selector */
.practice-modes {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.practice-mode-card {
  background: var(--bg-light);
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  border: 3px solid transparent;
}

.practice-mode-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.practice-mode-card.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary-hover);
}

.practice-mode-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.practice-mode-name {
  font-weight: 700;
  font-size: 1rem;
}

.practice-mode-desc {
  font-size: 0.8rem;
  margin-top: 0.5rem;
  opacity: 0.8;
}

/* Analysis Board */
.analysis-panel {
  background: var(--bg-white);
  border-radius: 12px;
  padding: 1.5rem;
  margin-top: 1.5rem;
}

.analysis-evaluation {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.eval-bar-container {
  flex: 1;
  height: 30px;
  background: #000;
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.eval-bar-white {
  height: 100%;
  background: white;
  transition: width 0.3s ease;
}

.eval-score {
  font-size: 1.5rem;
  font-weight: 700;
  min-width: 60px;
  text-align: center;
}

.best-move {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 8px;
  margin-top: 1rem;
}

.best-move-label {
  font-weight: 600;
  color: #666;
  margin-bottom: 0.5rem;
}

.best-move-notation {
  font-size: 1.3rem;
  font-weight: 700;
  font-family: 'Courier New', monospace;
  color: var(--primary);
}

/* Puzzle Rating Graph */
.rating-graph {
  width: 100%;
  height: 150px;
  position: relative;
  margin-top: 1rem;
}

.graph-line {
  stroke: var(--primary);
  stroke-width: 3;
  fill: none;
}

.graph-point {
  fill: var(--primary);
  cursor: pointer;
}

.graph-point:hover {
  fill: var(--primary-hover);
  r: 6;
}

.graph-grid {
  stroke: var(--border);
  stroke-width: 1;
  opacity: 0.3;
}

.graph-axis {
  stroke: var(--text-dark);
  stroke-width: 2;
}

.graph-label {
  font-size: 0.75rem;
  fill: #666;
}

/* Quick Stats Dashboard */
.quick-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.quick-stat-card {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: var(--shadow);
}

.quick-stat-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  opacity: 0.9;
}

.quick-stat-value {
  font-size: 2rem;
  font-weight: 700;
  line-height: 1;
}

.quick-stat-label {
  font-size: 0.9rem;
  opacity: 0.9;
  margin-top: 0.5rem;
}

/* Time Control Buttons */
.time-controls {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.time-btn {
  flex: 1;
  padding: 0.6rem;
  background: var(--bg-light);
  border: 2px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
}

.time-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.time-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* Puzzle Collection */
.puzzle-collection {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.puzzle-card {
  background: var(--bg-white);
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: all 0.3s;
}

.puzzle-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.puzzle-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.puzzle-card-title {
  font-weight: 700;
  font-size: 1.1rem;
}

.puzzle-card-mini-board {
  width: 100%;
  aspect-ratio: 1;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  border: 2px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 1rem;
}

.puzzle-card-square {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
}

.puzzle-card-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.puzzle-card-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.puzzle-card-stat-value {
  font-weight: 700;
  color: var(--primary);
}

.puzzle-card-stat-label {
  font-size: 0.8rem;
  color: #666;
}

/* Success Animation */
@keyframes successPulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(129, 182, 76, 0.7);
  }
  50% {
    box-shadow: 0 0 0 20px rgba(129, 182, 76, 0);
  }
}

.success-animation {
  animation: successPulse 1s ease;
}

/* Error Animation */
@keyframes errorShake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.error-animation {
  animation: errorShake 0.5s ease;
}

/* Confetti */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: var(--primary);
  position: fixed;
  top: -10px;
  z-index: 9999;
  animation: confettiFall 3s linear;
}

@keyframes confettiFall {
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

/* Elo Rating Display */
.elo-display {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 1.5rem;
}

.elo-icon {
  font-size: 3rem;
}

.elo-info {
  flex: 1;
}

.elo-label {
  font-size: 0.9rem;
  opacity: 0.9;
}

.elo-value {
  font-size: 2.5rem;
  font-weight: 700;
  line-height: 1;
  margin: 0.25rem 0;
}

.elo-change {
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

/* Puzzle Streak Flame */
.streak-flame {
  display: inline-block;
  animation: flameFlicker 1.5s ease-in-out infinite;
}

@keyframes flameFlicker {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.1) rotate(-5deg); }
  50% { transform: scale(0.9) rotate(5deg); }
  75% { transform: scale(1.05) rotate(-3deg); }
}

/* Tutorial Overlay */
.tutorial-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 3000;
  display: none;
  align-items: center;
  justify-content: center;
}

.tutorial-overlay.visible {
  display: flex;
}

.tutorial-box {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  max-width: 500px;
  width: 90%;
  position: relative;
}

.tutorial-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #666;
}

.tutorial-step {
  margin-bottom: 1.5rem;
}

.tutorial-step-number {
  display: inline-block;
  width: 30px;
  height: 30px;
  background: var(--primary);
  color: white;
  border-radius: 50%;
  text-align: center;
  line-height: 30px;
  font-weight: 700;
  margin-right: 0.5rem;
}

.tutorial-navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 2rem;
}

/* Share Button */
.share-btn {
  background: #1da1f2;
  color: white;
}

.share-btn:hover {
  background: #1a91da;
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  body.auto-theme {
    --bg-light: #2d2d2d;
    --bg-white: #1a1a1a;
    --text-dark: #e0e0e0;
    --border: #404040;
  }
  
  body.auto-theme .board {
    border-color: #404040;
  }
  
  body.auto-theme .modal-content,
  body.auto-theme .panel,
  body.auto-theme .board-section {
    background: #1a1a1a;
    color: #e0e0e0;
  }
}

/* Piece Promotion Modal */
.promotion-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 1rem;
  border-radius: 12px;
  box-shadow: var(--shadow-lg);
  z-index: 2001;
  display: none;
}

.promotion-modal.visible {
  display: block;
}

.promotion-pieces {
  display: flex;
  gap: 0.5rem;
}

.promotion-piece {
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
}

.promotion-piece:hover {
  background: var(--bg-light);
  transform: scale(1.1);
}

/* Mobile Menu */
.mobile-menu-btn {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
}

@media (max-width: 768px) {
  .mobile-menu-btn {
    display: block;
  }
  
  .nav {
    position: fixed;
    top: 70px;
    left: -100%;
    width: 100%;
    background: var(--text-dark);
    flex-direction: column;
    padding: 2rem;
    transition: left 0.3s;
  }
  
  .nav.visible {
    left: 0;
  }
}

/* Puzzle Timer Warning */
.timer.warning {
  color: var(--accent);
  animation: pulse 1s infinite;
}

/* Keyboard Shortcuts Help */
.shortcuts-help {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 8px;
  margin-top: 1rem;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
}

.shortcut-item:last-child {
  border-bottom: none;
}

.shortcut-key {
  background: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  font-weight: 700;
  border: 1px solid var(--border);
}

/* Export/Import Buttons */
.data-management {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

.export-btn, .import-btn {
  flex: 1;
  padding: 0.75rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.export-btn {
  background: var(--info);
  color: white;
  border: none;
}

.import-btn {
  background: var(--warning);
  color: white;
  border: none;
}

/* Custom Scrollbar for Moves List */
.moves-list::-webkit-scrollbar {
  width: 6px;
}

.moves-list::-webkit-scrollbar-track {
  background: var(--bg-light);
  border-radius: 10px;
}

.moves-list::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 10px;
}

/* Print Styles */
@media print {
  .header, .sidebar, .controls, .feedback {
    display: none !important;
  }
  
  .main-container {
    grid-template-columns: 1fr;
  }
  
  .board-section {
    box-shadow: none;
  }
}
</style>
</head>

<body>

<!-- Header -->
<header class="header">
  <div class="header-content">
    <a href="#" class="logo">
      <span class="logo-icon">‚ôü</span>
      <span>Zadania Szachowe Pro</span>
    </a>
    
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
    
    <nav class="nav" id="mainNav">
      <a href="#" class="nav-link">Trenuj</a>
      <a href="#" class="nav-link">Statystyki</a>
      <a href="#" class="nav-link">Ranking</a>
      <a href="#" class="nav-link">OsiƒÖgniƒôcia</a>
    </nav>
    
    <div class="user-stats">
      <div class="stat-item tooltip">
        <span class="stat-icon">üèÜ</span>
        <span id="userRating">1200</span>
        <span class="tooltiptext">Tw√≥j rating</span>
      </div>
      <div class="stat-item tooltip">
        <span class="stat-icon">üî•</span>
        <span id="userStreak">0</span>
        <span class="tooltiptext">Aktualna passa</span>
      </div>
    </div>
  </div>
</header>

<!-- Main Container -->
<div class="main-container">
  
  <!-- Board Section -->
  <div class="board-section">
    
    <!-- Puzzle Header -->
    <div class="puzzle-header">
      <div class="puzzle-title">
        <h1 id="puzzleTitle">Zadanie Taktyczne</h1>
        <div class="puzzle-meta">
          <span class="difficulty-badge easy" id="difficultyBadge">
            <span>‚≠ê</span>
            <span id="difficultyText">≈Åatwy</span>
          </span>
          <span class="rating-badge" id="ratingBadge">
            <span>üìä</span>
            <span id="puzzleRating">1200</span>
          </span>
          <div class="puzzle-tags" id="puzzleTags"></div>
        </div>
      </div>
      
      <div class="puzzle-info">
        <div class="timer" id="timer">
          <span>‚è±Ô∏è</span>
          <span id="timerDisplay">0:00</span>
        </div>
        <div class="moves-count">
          <span>üéØ</span>
          <span><span id="currentMove">0</span>/<span id="totalMoves">0</span></span>
        </div>
      </div>
    </div>
    
    <!-- Board Container -->
    <div class="board-container">
      <div class="board-wrapper">
        <div class="rank-coords coordinates" id="rankCoords"></div>
        <div id="chessBoard" class="board"></div>
        <div class="file-coords coordinates" id="fileCoords"></div>
      </div>
    </div>
    
    <!-- Controls -->
    <div class="controls">
      <button class="btn btn-primary" onclick="showHint()">
        <span class="btn-icon">üí°</span>
        <span>Podpowied≈∫</span>
        <span class="hint-cost">(-10 ü™ô)</span>
      </button>
      <button class="btn btn-secondary" onclick="resetPuzzle()">
        <span class="btn-icon">üîÑ</span>
        <span>Reset</span>
      </button>
      <button class="btn btn-secondary" onclick="undoMove()">
        <span class="btn-icon">‚Ü∂</span>
        <span>Cofnij</span>
      </button>
      <button class="btn btn-info" onclick="toggleSolution()">
        <span class="btn-icon">üîç</span>
        <span>RozwiƒÖzanie</span>
      </button>
      <button class="btn btn-success" onclick="nextPuzzle()">
        <span class="btn-icon">‚Üí</span>
        <span>Nastƒôpne</span>
      </button>
    </div>
    
    <!-- Solution Panel -->
    <div class="solution-panel" id="solutionPanel">
      <div class="solution-header">
        <span>‚úÖ</span>
        <span>RozwiƒÖzanie</span>
      </div>
      <div class="solution-moves" id="solutionMoves">
        1. Qg7#
      </div>
      <div class="solution-explanation" id="solutionExplanation">
        Hetman na g7 daje mata - kr√≥l nie ma ucieczki.
      </div>
    </div>
    
    <!-- Puzzle Navigation -->
    <div class="puzzle-nav">
      <button class="btn btn-secondary" onclick="previousPuzzle()">
        <span>‚Üê</span>
        <span>Poprzednie</span>
      </button>
      <div class="puzzle-counter">
        <span id="currentPuzzleNumber">1</span> / <span id="totalPuzzles">50</span>
      </div>
      <button class="btn btn-secondary" onclick="nextPuzzle()">
        <span>Nastƒôpne</span>
        <span>‚Üí</span>
      </button>
    </div>
    
  </div>
  
  <!-- Sidebar -->
  <div class="sidebar">
    
    <!-- Daily Challenge -->
    <div class="daily-challenge">
      <div class="daily-challenge-```html
header">
        <div class="daily-challenge-title">
          <span>üéØ</span>
          <span>Wyzwanie Dnia</span>
        </div>
        <div class="daily-challenge-timer">‚è≥ 18:42:15</div>
      </div>
      <div class="daily-challenge-reward">
        <span>Nagroda:</span>
        <span>+100 ü™ô</span>
        <span>+50 XP</span>
      </div>
    </div>
    
    <!-- Progress Panel -->
    <div class="panel">
      <h2 class="panel-header">
        <span class="panel-icon">üìä</span>
        <span>Tw√≥j Postƒôp</span>
      </h2>
      <div class="progress-container">
        <div class="progress-item">
          <span class="progress-label">Dzisiejsze zadania</span>
          <span class="progress-value"><span id="todaysSolved">0</span>/10</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="todaysProgress" style="width: 0%"></div>
        </div>
        
        <div class="progress-item" style="margin-top: 1rem;">
          <span class="progress-label">Celno≈õƒá</span>
          <span class="progress-value"><span id="accuracyPercent">0</span>%</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="accuracyBar" style="width: 0%"></div>
        </div>
        
        <div class="progress-item" style="margin-top: 1rem;">
          <span class="progress-label">Seria zwyciƒôstw</span>
          <span class="progress-value">
            <span class="streak-flame">üî•</span>
            <span id="currentStreak">0</span>
          </span>
        </div>
      </div>
      
      <div class="stats-grid" style="margin-top: 1.5rem;">
        <div class="stat-card">
          <div class="stat-value" id="totalSolved">0</div>
          <div class="stat-label">RozwiƒÖzane</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalAttempts">0</div>
          <div class="stat-label">Pr√≥by</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="averageTime">0:00</div>
          <div class="stat-label">≈ör. czas</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="bestStreak">0</div>
          <div class="stat-label">Najlepsza passa</div>
        </div>
      </div>
    </div>
    
    <!-- Moves History -->
    <div class="panel">
      <h2 class="panel-header">
        <span class="panel-icon">üìù</span>
        <span>Historia Ruch√≥w</span>
      </h2>
      <div class="moves-list" id="movesList">
        <div style="text-align: center; color: #999; padding: 2rem;">
          Brak ruch√≥w
        </div>
      </div>
    </div>
    
    <!-- Settings Panel -->
    <div class="panel">
      <h2 class="panel-header">
        <span class="panel-icon">‚öôÔ∏è</span>
        <span>Ustawienia</span>
      </h2>
      
      <div class="settings-group">
        <label class="settings-label">Motyw szachownicy</label>
        <div class="theme-selector">
          <div class="theme-option theme-classic active" onclick="changeTheme('classic')" title="Klasyczny"></div>
          <div class="theme-option theme-blue" onclick="changeTheme('blue')" title="Niebieski"></div>
          <div class="theme-option theme-green" onclick="changeTheme('green')" title="Zielony"></div>
          <div class="theme-option theme-brown" onclick="changeTheme('brown')" title="BrƒÖzowy"></div>
        </div>
      </div>
      
      <div class="setting-item">
        <span>D≈∫wiƒôki</span>
        <label class="toggle-switch">
          <input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="setting-item">
        <span>Auto-nastƒôpne zadanie</span>
        <label class="toggle-switch">
          <input type="checkbox" id="autoNext" onchange="toggleAutoNext()">
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="setting-item">
        <span>Pod≈õwietlanie ruch√≥w</span>
        <label class="toggle-switch">
          <input type="checkbox" id="highlightMoves" checked onchange="toggleHighlight()">
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="setting-item">
        <span>Wsp√≥≈Çrzƒôdne</span>
        <label class="toggle-switch">
          <input type="checkbox" id="showCoords" checked onchange="toggleCoords()">
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <!-- Achievements -->
    <div class="panel">
      <h2 class="panel-header">
        <span class="panel-icon">üèÖ</span>
        <span>OsiƒÖgniƒôcia</span>
      </h2>
      <div class="achievements">
        <div class="achievement" id="achievement1" title="Pierwsze zadanie">
          <div class="achievement-icon">üéØ</div>
          <div class="achievement-name">PoczƒÖtek</div>
        </div>
        <div class="achievement" id="achievement2" title="10 zada≈Ñ">
          <div class="achievement-icon">‚≠ê</div>
          <div class="achievement-name">Amator</div>
        </div>
        <div class="achievement" id="achievement3" title="50 zada≈Ñ">
          <div class="achievement-icon">üî•</div>
          <div class="achievement-name">Pasjonat</div>
        </div>
        <div class="achievement" id="achievement4" title="100 zada≈Ñ">
          <div class="achievement-icon">üíé</div>
          <div class="achievement-name">Mistrz</div>
        </div>
        <div class="achievement" id="achievement5" title="Seria 10">
          <div class="achievement-icon">‚ö°</div>
          <div class="achievement-name">Nieustƒôpliwy</div>
        </div>
        <div class="achievement" id="achievement6" title="Perfekcja">
          <div class="achievement-icon">üëë</div>
          <div class="achievement-name">Perfekcja</div>
        </div>
      </div>
    </div>
    
  </div>
  
</div>

<!-- Feedback Messages -->
<div class="feedback" id="feedback">
  <span class="feedback-icon" id="feedbackIcon">‚úì</span>
  <span id="feedbackText">≈öwietny ruch!</span>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal">
  <div class="modal-content">
    <div class="modal-icon">üéâ</div>
    <h2 class="modal-title">Gratulacje!</h2>
    <p class="modal-message">RozwiƒÖza≈Çe≈õ zadanie poprawnie!</p>
    
    <div class="modal-stats">
      <div class="modal-stat">
        <div class="modal-stat-value" id="modalTime">0:00</div>
        <div class="modal-stat-label">Czas</div>
      </div>
      <div class="modal-stat">
        <div class="modal-stat-value" id="modalMoves">0</div>
        <div class="modal-stat-label">Ruchy</div>
      </div>
      <div class="modal-stat">
        <div class="modal-stat-value" id="modalRating">+10</div>
        <div class="modal-stat-label">Rating</div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal()">Zamknij</button>
      <button class="btn btn-success" onclick="nextPuzzle()">Nastƒôpne ‚Üí</button>
    </div>
  </div>
</div>

<!-- Combo Display -->
<div class="combo-display" id="comboDisplay">COMBO x3!</div>

<!-- Sound Toggle Button -->
<button class="sound-toggle" id="soundBtn" onclick="toggleSound()">üîä</button>

<script>
// ==================== CONSTANTS ====================
const PIECES = {
  wK: '‚ôî', wQ: '‚ôï', wR: '‚ôñ', wB: '‚ôó', wN: '‚ôò', wP: '‚ôô',
  bK: '‚ôö', bQ: '‚ôõ', bR: '‚ôú', bB: '‚ôù', bN: '‚ôû', bP: '‚ôü'
};

const FILES = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
const RANKS = ['8', '7', '6', '5', '4', '3', '2', '1'];

// ==================== PUZZLE DATABASE ====================
const PUZZLES = [
  {
    id: 1,
    title: "Mat w 1 ruchu",
    description: "Bia≈Çe do ruchu. Znajd≈∫ matujƒÖcƒÖ sekwencjƒô.",
    difficulty: "easy",
    rating: 1200,
    tags: ["mate", "basic"],
    position: {
      g1: 'wK', g5: 'wQ', g8: 'bK'
    },
    solution: ['Qg7'],
    toMove: 'white',
    explanation: "Hetman na g7 daje mata. Kr√≥l czarny nie ma ucieczki - hetman kontroluje h8, h7 i f8."
  },
  {
    id: 2,
    title: "Widelec skoczka",
    description: "Bia≈Çe mogƒÖ wygraƒá materia≈Ç. Jak?",
    difficulty: "easy",
    rating: 1250,
    tags: ["fork", "knight"],
    position: {
      e1: 'wK', d4: 'wN', f3: 'wB',
      e8: 'bK', c6: 'bQ', f6: 'bN'
    },
    solution: ['Ne6'],
    toMove: 'white',
    explanation: "Skoczek na e6 atakuje jednocze≈õnie hetmana i kr√≥la (widelec). Czarne tracƒÖ hetmana."
  },
  {
    id: 3,
    title: "Mat wie≈ºami",
    description: "Bia≈Çe matujƒÖ w 2 ruchach.",
    difficulty: "medium",
    rating: 1400,
    tags: ["mate", "rook", "endgame"],
    position: {
      e1: 'wK', d1: 'wR', h1: 'wR',
      e8: 'bK', a7: 'bP', b7: 'bP'
    },
    solution: ['Rd8', 'Rh7'],
    toMove: 'white',
    explanation: "1. Rd8+ wymusza Kf7. 2. Rh7# - wie≈ºa daje mata, kr√≥l nie ma ucieczki."
  },
  {
    id: 4,
    title: "Odkryty atak",
    description: "Wykorzystaj odkryty atak!",
    difficulty: "medium",
    rating: 1450,
    tags: ["discovered-attack", "bishop"],
    position: {
      e1: 'wK', d3: 'wB', e4: 'wN', h1: 'wR',
      e8: 'bK', d8: 'bQ', f6: 'bN', a8: 'bR'
    },
    solution: ['Nf6'],
    toMove: 'white',
    explanation: "Skoczek na f6+ odkrywa atak go≈Ñca na hetmana. Czarne tracƒÖ hetmana."
  },
  {
    id: 5,
    title: "Przebicie",
    description: "Wykorzystaj przebicie!",
    difficulty: "medium",
    rating: 1500,
    tags: ["skewer", "rook"],
    position: {
      a1: 'wK', e1: 'wR',
      e8: 'bK', e5: 'bQ', h8: 'bR'
    },
    solution: ['Re5'],
    toMove: 'white',
    explanation: "Wie≈ºa bije hetmana z szachem. Po odsuniƒôciu kr√≥la, bia≈Çe wygra≈Çy hetmana."
  },
  {
    id: 6,
    title: "ZwiƒÖzanie",
    description: "Figura przeciwnika jest zwiƒÖzana!",
    difficulty: "easy",
    rating: 1300,
    tags: ["pin", "bishop"],
    position: {
      e1: 'wK', c3: 'wB', d4: 'wP',
      e8: 'bK', d5: 'bN', c6: 'bP'
    },
    solution: ['dxd5'],
    toMove: 'white',
    explanation: "Skoczek jest zwiƒÖzany przez go≈Ñca - nie mo≈ºe siƒô ruszyƒá, bo odkryje szach."
  },
  {
    id: 7,
    title: "Podw√≥jny atak hetmanem",
    description: "Hetman atakuje dwa cele!",
    difficulty: "easy",
    rating: 1350,
    tags: ["double-attack", "queen"],
    position: {
      e1: 'wK', d1: 'wQ',
      e8: 'bK', a5: 'bR', h5: 'bR'
    },
    solution: ['Qa4'],
    toMove: 'white',
    explanation: "Hetman na a4 atakuje obie wie≈ºe. Czarne mogƒÖ obroniƒá tylko jednƒÖ."
  },
  {
    id: 8,
    title: "Mat pasterski",
    description: "Klasyczny mat w debiucie!",
    difficulty: "easy",
    rating: 1150,
    tags: ["mate", "opening"],
    position: {
      e1: 'wK', f3: 'wQ', c4: 'wB',
      e8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Qxf7'],
    toMove: 'white',
    explanation: "Hetman bierze piona na f7 i daje mata. Kr√≥l nie mo≈ºe uciec."
  },
  {
    id: 9,
    title: "Usuniƒôcie obro≈Ñcy",
    description: "Usu≈Ñ obro≈Ñcƒô kluczowego pola!",
    difficulty: "medium",
    rating: 1550,
    tags: ["removal", "tactic"],
    position: {
      e1: 'wK', d1: 'wQ', f1: 'wR',
      e8: 'bK', f8: 'bR', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Rxf8', 'Qd8'],
    toMove: 'white',
    explanation: "1. Rxf8+ usuwa obro≈Ñcƒô. 2. Qd8# mat."
  },
  {
    id: 10,
    title: "Atak rentgenowski",
    description: "Wykorzystaj atak przez figurƒô!",
    difficulty: "hard",
    rating: 1650,
    tags: ["x-ray", "rook"],
    position: {
      a1: 'wK', e1: 'wR',
      h1: 'bK', e5: 'bQ', e8: 'bR'
    },
    solution: ['Rxe5'],
    toMove: 'white',
    explanation: "Wie≈ºa bije hetmana odkrywajƒÖc atak na wie≈ºƒô. Czarne tracƒÖ materia≈Ç."
  },
  {
    id: 11,
    title: "Desperacki szach",
    description: "Znajd≈∫ mat pomimo gorszej pozycji!",
    difficulty: "hard",
    rating: 1700,
    tags: ["mate", "desperado"],
    position: {
      g1: 'wK', d1: 'wQ', f1: 'wR',
      a8: 'bK', a7: 'bP', b7: 'bP', h8: 'bR'
    },
    solution: ['Qd8', 'Qxa8'],
    toMove: 'white',
    explanation: "1. Qd8+ Rxd8 2. Rxd8# - po≈õwiƒôcenie hetmana prowadzi do mata."
  },
  {
    id: 12,
    title: "Widelec pionem",
    description: "Nawet pion mo≈ºe wykonaƒá widelec!",
    difficulty: "easy",
    rating: 1200,
    tags: ["fork", "pawn"],
    position: {
      e1: 'wK', d4: 'wP',
      e8: 'bK', c5: 'bN', e5: 'bB'
    },
    solution: ['d5'],
    toMove: 'white',
    explanation: "Pion atakuje skoczka i go≈Ñca. Czarne tracƒÖ figurƒô."
  },
  {
    id: 13,
    title: "Zwabienie kr√≥la",
    description: "Zwabiaj kr√≥la w pu≈Çapkƒô!",
    difficulty: "medium",
    rating: 1500,
    tags: ["deflection", "mate"],
    position: {
      g1: 'wK', e4: 'wQ', h1: 'wR',
      e8: 'bK', f8: 'bR', g7: 'bP', h7: 'bP'
    },
    solution: ['Qe8', 'Rh8'],
    toMove: 'white',
    explanation: "1. Qe8+ Rxe8 2. Rxe8# - klasyczne zwabienie."
  },
  {
    id: 14,
    title: "Blokada",
    description: "Zablokuj drogƒô ucieczki!",
    difficulty: "medium",
    rating: 1450,
    tags: ["blockade", "mate"],
    position: {
      a1: 'wK', h1: 'wR', g2: 'wP',
      h8: 'bK', h7: 'bP', g7: 'bP', f6: 'bR'
    },
    solution: ['Rh6'],
    toMove: 'white',
    explanation: "Wie≈ºa blokuje drogƒô ucieczki i przygotowuje mata."
  },
  {
    id: 15,
    title: "Po≈õwiƒôcenie wie≈ºy",
    description: "Czasem warto po≈õwiƒôciƒá wie≈ºƒô!",
    difficulty: "hard",
    rating: 1750,
    tags: ["sacrifice", "mate"],
    position: {
      g1: 'wK', h1: 'wR', g2: 'wP', h2: 'wP', f3: 'wQ',
      e8: 'bK', g8: 'bR', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Rxg8', 'Qf7'],
    toMove: 'white',
    explanation: "1. Rxg8+! Kxg8 2. Qf7# - po≈õwiƒôcenie prowadzi do mata."
  },
  {
    id: 16,
    title: "Mat go≈Ñcem i skoczkiem",
    description: "Wykorzystaj wsp√≥≈Çpracƒô lekkich figur!",
    difficulty: "medium",
    rating: 1550,
    tags: ["mate", "knight", "bishop"],
    position: {
      a1: 'wK', f6: 'wN', c4: 'wB',
      h8: 'bK', g8: 'bP', h7: 'bP'
    },
    solution: ['Bf7'],
    toMove: 'white',
    explanation: "Goniec na f7 daje mata wraz ze skoczkiem. Kr√≥l nie ma ucieczki."
  },
  {
    id: 17,
    title: "Atak na kr√≥la w centrum",
    description: "Ukaraj kr√≥la w centrum!",
    difficulty: "easy",
    rating: 1250,
    tags: ["attack", "center"],
    position: {
      a1: 'wK', d1: 'wQ', a2: 'wP', b2: 'wP',
      e8: 'bK', d7: 'bP', e7: 'bP', f7: 'bP'
    },
    solution: ['Qd8'],
    toMove: 'white',
    explanation: "Hetman daje mata. Kr√≥l w centrum jest bezbronny."
  },
  {
    id: 18,
    title: "Prze≈Çamanie obrony",
    description: "Prze≈Çam obronƒô pawn√≥w!",
    difficulty: "hard",
    rating: 1800,
    tags: ["breakthrough", "pawn"],
    position: {
      a1: 'wK', f5: 'wP', g5: 'wP', h5: 'wP',
      h8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['g6', 'fxg6', 'h6'],
    toMove: 'white',
    explanation: "Prze≈Çamanie: 1. g6! fxg6 2. h6! gxh6 3. f6 i pion promuje."
  },
  {
    id: 19,
    title: "Tempo",
    description: "Wygraj tempo z szachem!",
    difficulty: "medium",
    rating: 1500,
    tags: ["tempo", "check"],
    position: {
      e1: 'wK', d4: 'wQ', f1: 'wR',
      e8: 'bK', d8: 'bQ', a8: 'bR', h8: 'bR'
    },
    solution: ['Qd8', 'Rf8'],
    toMove: 'white',
    explanation: "1. Qd8+ wymusza wymianƒô hetman√≥w. 2. Rf8# mat."
  },
  {
    id: 20,
    title: "Klinowanie",
    description: "Wklnuj figurƒô przeciwnika!",
    difficulty: "easy",
    rating: 1300,
    tags: ["pin", "rook"],
    position: {
      a1: 'wK', d1: 'wR',
      h8: 'bK', d5: 'bQ', d8: 'bR'
    },
    solution: ['Rxd5'],
    toMove: 'white',
    explanation: "Wie≈ºa bije hetmana. Wie≈ºa czarna jest sklinowana i nie mo≈ºe biƒá."
  },
  {
    id: 21,
    title: "Mat duszony",
    description: "Klasyczny mat duszony!",
    difficulty: "medium",
    rating: 1600,
    tags: ["smothered", "mate", "knight"],
    position: {
      a1: 'wK', f6: 'wN', e4: 'wQ',
      h8: 'bK', g8: 'bR', g7: 'bP', h7: 'bP'
    },
    solution: ['Qg8', 'Nf7'],
    toMove: 'white',
    explanation: "1. Qg8+! Rxg8 2. Nf7# - mat duszony skoczkiem."
  },
  {
    id: 22,
    title: "Atakuj s≈Çabo≈õci",
    description: "Wykorzystaj s≈Çabe pola!",
    difficulty: "medium",
    rating: 1450,
    tags: ["weakness", "attack"],
    position: {
      e1: 'wK', d1: 'wQ', f1: 'wR',
      e8: 'bK', f7: 'bP', h7: 'bP', e6: 'bB'
    },
    solution: ['Qd8', 'Rf8'],
    toMove: 'white',
    explanation: "Atak na s≈Çabe pole f8 prowadzi do mata."
  },
  {
    id: 23,
    title: "Przeciwatak",
    description: "Najlepsza obrona to atak!",
    difficulty: "hard",
    rating: 1700,
    tags: ["counterattack", "mate"],
    position: {
      g1: 'wK', d1: 'wQ', h1: 'wR', g2: 'wP', h2: 'wP',
      a8: 'bK', a1: 'bQ', a7: 'bP', b7: 'bP'
    },
    solution: ['Qd8', 'Qxa8', 'Rh8'],
    toMove: 'white',
    explanation: "IgnorujƒÖc zagro≈ºenie, bia≈Çe matujƒÖ: 1. Qd8+ Qxa8 (jedyna) 2. Qxa8+ Kb8 3. Rh8#"
  },
  {
    id: 24,
    title: "Interferencja",
    description: "Przerwij liniƒô obrony!",
    difficulty: "hard",
    rating: 1650,
    tags: ["interference", "tactic"],
    position: {
      a1: 'wK', e1: 'wR', d4: 'wB',
      h8: 'bK', e8: 'bR', e5: 'bQ'
    },
    solution: ['Re4'],
    toMove: 'white',
    explanation: "Wie≈ºa na e4 przerywa obronƒô hetmana. Goniec mo≈ºe go zbiƒá."
  },
  {
    id: 25,
    title: "Promocja piona",
    description: "Doprowad≈∫ piona do promocji!",
    difficulty: "medium",
    rating: 1500,
    tags: ["promotion", "endgame"],
    position: {
      a1: 'wK', a7: 'wP', e1: 'wR',
      h8: 'bK', e8: 'bR'
    },
    solution: ['a8=Q'],
    toMove: 'white',
    explanation: "Pion promuje na hetmana z szachem. Bia≈Çe wygrywajƒÖ."
  },
  {
    id: 26,
    title: "Mat w naro≈ºniku",
    description: "Kr√≥l w naro≈ºniku jest bezsilny!",
    difficulty: "easy",
    rating: 1250,
    tags: ["mate", "corner"],
    position: {
      a1: 'wK', h1: 'wR', g2: 'wR',
      h8: 'bK', g7: 'bP', h7: 'bP'
    },
    solution: ['Rh2'],
    toMove: 'white',
    explanation: "Wie≈ºa na h2 daje mata. Kr√≥l nie ma ucieczki z naro≈ºnika."
  },
  {
    id: 27,
    title: "Wielokrotny atak",
    description: "Atakuj kilka cel√≥w jednocze≈õnie!",
    difficulty: "medium",
    rating: 1550,
    tags: ["multiple-attack", "queen"],
    position: {
      e1: 'wK', d1: 'wQ',
      e8: 'bK', a5: 'bR', h5: 'bN', e4: 'bB'
    },
    solution: ['Qd5'],
    toMove: 'white',
    explanation: "Hetman atakuje wie≈ºƒô, skoczka i go≈Ñca. Nie wszystkie mo≈ºna obroniƒá."
  },
  {
    id: 28,
    title: "Zniszczenie ochrony kr√≥la",
    description: "Zniszcz ochronƒô przeciwnika!",
    difficulty: "hard",
    rating: 1750,
    tags: ["demolition", "attack"],
    position: {
      g1: 'wK', h1: 'wR', d1: 'wQ', g2: 'wP', h2: 'wP',
      g8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP', h8: 'bR'
    },
    solution: ['Qxh7', 'Qxg7'],
    toMove: 'white',
    explanation: "1. Qxh7+! Kxh7 2. Rh1+ Kg8 3. Rh8#"
  },
  {
    id: 29,
    title: "Atak na dwie fronty",
    description: "Atakuj z dw√≥ch stron!",
    difficulty: "medium",
    rating: 1500,
    tags: ["attack", "coordination"],
    position: {
      a1: 'wK', a8: 'wR', h8: 'wR',
      e4: 'bK', d4: 'bP', e5: 'bP', f4: 'bP'
    },
    solution: ['Ra4'],
    toMove: 'white',
    explanation: "Wie≈ºe wsp√≥≈ÇpracujƒÖ matujƒÖc kr√≥la w centrum."
  },
  {
    id: 30,
    title: "Pu≈Çapka debiutowa",
    description: "Klasyczna pu≈Çapka w otwarciu!",
    difficulty: "easy",
    rating: 1200,
    tags: ["trap", "opening"],
    position: {
      e1: 'wK', d1: 'wQ', f1: 'wB', b1: 'wN', g1: 'wN',
      e8: 'bK', d8: 'bQ', f8: 'bB', f6: 'bN', g8: 'bN', e5: 'bP'
        ```html
},
    solution: ['Nxe5'],
    toMove: 'white',
    explanation: "Skoczek bije piona wykorzystujƒÖc s≈ÇabƒÖ obronƒô. Czarne tracƒÖ materia≈Ç."
  },
  {
    id: 31,
    title: "Gra o opozycjƒô",
    description: "Wygraj ko≈Ñc√≥wkƒô przez opozycjƒô!",
    difficulty: "hard",
    rating: 1800,
    tags: ["opposition", "endgame", "king"],
    position: {
      e4: 'wK', e5: 'wP',
      e6: 'bK'
    },
    solution: ['Kd5'],
    toMove: 'white',
    explanation: "Kr√≥l zajmuje opozycjƒô i przecina drogƒô czarnemu kr√≥lowi. Pion promuje."
  },
  {
    id: 32,
    title: "Cios podw√≥jny",
    description: "Zadaj dwa zagro≈ºenia jednocze≈õnie!",
    difficulty: "medium",
    rating: 1550,
    tags: ["double-threat", "tactic"],
    position: {
      e1: 'wK', d3: 'wQ', f1: 'wR',
      e8: 'bK', d8: 'bR', f8: 'bB'
    },
    solution: ['Qd7'],
    toMove: 'white',
    explanation: "Hetman atakuje wie≈ºƒô i grozi matem na e8."
  },
  {
    id: 33,
    title: "Pu≈Çapka na hetmana",
    description: "Z≈Çap hetmana przeciwnika!",
    difficulty: "medium",
    rating: 1500,
    tags: ["trap", "queen"],
    position: {
      e1: 'wK', d1: 'wR', c3: 'wN',
      e8: 'bK', d4: 'bQ', d8: 'bR'
    },
    solution: ['Nb5'],
    toMove: 'white',
    explanation: "Skoczek atakuje hetmana, kt√≥ry nie ma dobrego pola."
  },
  {
    id: 34,
    title: "Wykorzystaj s≈ÇabƒÖ √≥smƒÖ liniƒô",
    description: "Inwazja na √≥smƒÖ liniƒô!",
    difficulty: "easy",
    rating: 1300,
    tags: ["back-rank", "mate"],
    position: {
      g1: 'wK', a1: 'wR', f2: 'wP', g2: 'wP', h2: 'wP',
      g8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Ra8'],
    toMove: 'white',
    explanation: "Wie≈ºa na √≥smej linii daje mata. Kr√≥l nie mo≈ºe uciec."
  },
  {
    id: 35,
    title: "Taktyka w ko≈Ñc√≥wce",
    description: "Precyzja w ko≈Ñc√≥wce wie≈ºowej!",
    difficulty: "hard",
    rating: 1700,
    tags: ["endgame", "rook"],
    position: {
      a1: 'wK', h1: 'wR', a2: 'wP',
      a8: 'bK', a7: 'bP', h8: 'bR'
    },
    solution: ['Rh8', 'Rxa7'],
    toMove: 'white',
    explanation: "1. Rh8+ Kb7 2. Rh7+ wygrywa piona i partiƒô."
  },
  {
    id: 36,
    title: "Atak na kr√≥la bez hetman√≥w",
    description: "Mat bez hetman√≥w jest mo≈ºliwy!",
    difficulty: "medium",
    rating: 1600,
    tags: ["mate", "middlegame"],
    position: {
      g1: 'wK', d1: 'wR', f1: 'wR', c4: 'wB',
      e8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP', a8: 'bR'
    },
    solution: ['Rd8', 'Rfd1'],
    toMove: 'white',
    explanation: "Wie≈ºe na linii d matujƒÖ kr√≥la. 1. Rd8+ Rxd8 2. Rxd8#"
  },
  {
    id: 37,
    title: "Zdwojone wie≈ºe",
    description: "Potƒôga zdwojonych wie≈º!",
    difficulty: "easy",
    rating: 1250,
    tags: ["rook", "battery"],
    position: {
      a1: 'wK', d1: 'wR', d2: 'wR',
      e8: 'bK', d8: 'bR'
    },
    solution: ['Rxd8'],
    toMove: 'white',
    explanation: "Pierwsza wie≈ºa bije, druga wspiera. Czarne tracƒÖ wie≈ºƒô."
  },
  {
    id: 38,
    title: "Prze≈Çamanie",
    description: "Prze≈Çam obronƒô przeciwnika!",
    difficulty: "hard",
    rating: 1750,
    tags: ["breakthrough", "attack"],
    position: {
      g1: 'wK', e4: 'wQ', h1: 'wR', g2: 'wP', h2: 'wP',
      g8: 'bK', e8: 'bR', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Qe7', 'Rh8'],
    toMove: 'white',
    explanation: "1. Qe7! wymusza os≈Çabienia. Po wymianie nastƒôpuje Rh8#."
  },
  {
    id: 39,
    title: "Wielka kombinacja",
    description: "Z≈Ço≈ºona kombinacja taktyczna!",
    difficulty: "expert",
    rating: 1900,
    tags: ["combination", "sacrifice"],
    position: {
      g1: 'wK', d1: 'wQ', f1: 'wR', h1: 'wR', c4: 'wB',
      g8: 'bK', d8: 'bQ', f7: 'bP', g7: 'bP', h7: 'bP', a8: 'bR', h8: 'bR'
    },
    solution: ['Qxd8', 'Rxd8', 'Rxf7', 'Rf8', 'Rxf8'],
    toMove: 'white',
    explanation: "1. Qxd8+! Rxd8 2. Rxf7+ Kg8 3. Rf8+ Rxf8 4. Rxf8#"
  },
  {
    id: 40,
    title: "Roszada to pu≈Çapka",
    description: "Ukaraj przedwczesnƒÖ roszadƒô!",
    difficulty: "medium",
    rating: 1500,
    tags: ["castling", "attack"],
    position: {
      e1: 'wK', d1: 'wQ', f1: 'wB',
      g8: 'bK', f8: 'bR', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Qd8'],
    toMove: 'white',
    explanation: "Hetman na d8 daje mata po roszadzie. Kr√≥l uwiƒôziony za w≈ÇasnƒÖ wie≈ºƒÖ."
  },
  {
    id: 41,
    title: "Mat Anastazji",
    description: "Klasyczny mat nazwany!",
    difficulty: "medium",
    rating: 1600,
    tags: ["mate", "pattern"],
    position: {
      a1: 'wK', h5: 'wN', e1: 'wR',
      h8: 'bK', g7: 'bP', h7: 'bP'
    },
    solution: ['Rh1'],
    toMove: 'white',
    explanation: "Wie≈ºa na h1 i skoczek na h5/f6 tworzƒÖ mat Anastazji."
  },
  {
    id: 42,
    title: "S≈Çaby punkt f7",
    description: "Atakuj najs≈Çabszy punkt!",
    difficulty: "easy",
    rating: 1200,
    tags: ["weakness", "f7"],
    position: {
      e1: 'wK', d1: 'wQ', c4: 'wB',
      e8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Bxf7'],
    toMove: 'white',
    explanation: "Goniec bije s≈Çabego piona f7 z szachem, niszczƒÖc obronƒô kr√≥la."
  },
  {
    id: 43,
    title: "Windmill",
    description: "Taktyka wiatraka!",
    difficulty: "expert",
    rating: 1950,
    tags: ["windmill", "advanced"],
    position: {
      a1: 'wK', b7: 'wB', h1: 'wR',
      g8: 'bK', a8: 'bR', b8: 'bN', c8: 'bB', f7: 'bP', g7: 'bP', h7: 'bP'
    },
    solution: ['Rxh7', 'Rh8', 'Rh7'],
    toMove: 'white',
    explanation: "1. Rxh7+ Kg8 2. Rh8+ Kg7 3. Rxc8 - seria szach√≥w zbierajƒÖca figury."
  },
  {
    id: 44,
    title: "Klinch pozycyjny",
    description: "Sklinuj pozycjƒô przeciwnika!",
    difficulty: "medium",
    rating: 1550,
    tags: ["positional", "restriction"],
    position: {
      e1: 'wK', d4: 'wP', e4: 'wP', f4: 'wP',
      e8: 'bK', d5: 'bP', e5: 'bP', f5: 'bP', d7: 'bN'
    },
    solution: ['e5'],
    toMove: 'white',
    explanation: "Pion na e5 klinuje skoczka i parali≈ºuje pozycjƒô czarnych."
  },
  {
    id: 45,
    title: "Mat arabski",
    description: "Skoczek i wie≈ºa matujƒÖ!",
    difficulty: "medium",
    rating: 1500,
    tags: ["mate", "knight", "rook"],
    position: {
      a1: 'wK', f6: 'wN', h1: 'wR',
      h8: 'bK', g7: 'bP', h7: 'bP'
    },
    solution: ['Rh7'],
    toMove: 'white',
    explanation: "Wie≈ºa i skoczek wsp√≥≈ÇpracujƒÖ dajƒÖc mata - mat arabski."
  },
  {
    id: 46,
    title: "Awans mniejszo≈õci",
    description: "Awans pion√≥w mniejszo≈õci!",
    difficulty: "hard",
    rating: 1700,
    tags: ["pawn", "endgame"],
    position: {
      a1: 'wK', b4: 'wP', c5: 'wP',
      h8: 'bK', a6: 'bP', b7: 'bP', c7: 'bP'
    },
    solution: ['b5'],
    toMove: 'white',
    explanation: "Awans pion√≥w tworzy s≈Çabo≈õci w pozycji czarnych."
  },
  {
    id: 47,
    title: "Cios grecka",
    description: "Klasyczne po≈õwiƒôcenie!",
    difficulty: "hard",
    rating: 1800,
    tags: ["sacrifice", "attack", "greek-gift"],
    position: {
      g1: 'wK', d1: 'wQ', c4: 'wB', g5: 'wN',
      g8: 'bK', f7: 'bP', g7: 'bP', h7: 'bP', h8: 'bR'
    },
    solution: ['Bxh7', 'Qg4'],
    toMove: 'white',
    explanation: "1. Bxh7+! Kxh7 2. Ng5+ Kg8 (lub Kg6) 3. Qg4 z matujƒÖcym atakiem."
  },
  {
    id: 48,
    title: "Zwyciƒôska ko≈Ñc√≥wka",
    description: "Technika w ko≈Ñc√≥wce!",
    difficulty: "medium",
    rating: 1600,
    tags: ["endgame", "technique"],
    position: {
      a1: 'wK', a7: 'wP', h1: 'wR',
      a8: 'bK', h8: 'bR'
    },
    solution: ['Rh8'],
    toMove: 'white',
    explanation: "1. Rh8+! Rxh8 2. a8=Q+ wygrywa. Typowa ko≈Ñc√≥wka."
  },
  {
    id: 49,
    title: "Desperacja",
    description: "Desperackie po≈õwiƒôcenie!",
    difficulty: "expert",
    rating: 2000,
    tags: ["desperado", "sacrifice"],
    position: {
      g1: 'wK', d1: 'wQ', h1: 'wR', g2: 'wP', h2: 'wP',
      a8: 'bK', a1: 'bQ', a7: 'bP', b7: 'bP'
    },
    solution: ['Qd8', 'Qxa8', 'Qxa8', 'Rh8'],
    toMove: 'white',
    explanation: "1. Qd8+! Qxa8 2. Qxa8+ Kb8 3. Qa7+! Ka8 4. Rh8#"
  },
  {
    id: 50,
    title: "Fina≈Çowa kombinacja",
    description: "Wielka fina≈Çowa kombinacja!",
    difficulty: "expert",
    rating: 2100,
    tags: ["combination", "mate", "brilliant"],
    position: {
      g1: 'wK', d1: 'wQ', f1: 'wB', h1: 'wR', f3: 'wN',
      g8: 'bK', d8: 'bQ', c8: 'bB', f7: 'bP', g7: 'bP', h7: 'bP', a8: 'bR', h8: 'bR'
    },
    solution: ['Bxh7', 'Ng5', 'Qh5', 'Qxh7'],
    toMove: 'white',
    explanation: "1. Bxh7+! Kxh7 2. Ng5+ Kg8 (Kg6 3. Qg4) 3. Qh5 Re8 4. Qxf7+ Kh8 5. Qh7#"
  }
];

// ==================== GAME STATE ====================
let currentPuzzleIndex = 0;
let currentPosition = {};
let selectedSquare = null;
let moveHistory = [];
let solutionIndex = 0;
let timerInterval = null;
let startTime = 0;
let elapsedTime = 0;
let hintsUsed = 0;
let soundEnabled = true;
let highlightEnabled = true;
let showCoordinates = true;
let autoNextEnabled = false;

// Stats
let userStats = {
  rating: 1200,
  totalSolved: 0,
  totalAttempts: 0,
  currentStreak: 0,
  bestStreak: 0,
  todaysSolved: 0,
  accuracyPercent: 0,
  averageTime: 0,
  achievements: new Set()
};

// Load stats from localStorage
function loadStats() {
  const saved = localStorage.getItem('chessStats');
  if (saved) {
    const parsed = JSON.parse(saved);
    userStats = { ...userStats, ...parsed };
    userStats.achievements = new Set(parsed.achievements || []);
    updateStatsDisplay();
  }
}

// Save stats to localStorage
function saveStats() {
  const toSave = {
    ...userStats,
    achievements: Array.from(userStats.achievements)
  };
  localStorage.setItem('chessStats', JSON.stringify(toSave));
}

// ==================== INITIALIZATION ====================
function init() {
  loadStats();
  renderCoordinates();
  loadPuzzle(currentPuzzleIndex);
  updateStatsDisplay();
  updateDailyChallengeTimer();
  setInterval(updateDailyChallengeTimer, 1000);
}

// ==================== BOARD RENDERING ====================
function renderCoordinates() {
  const fileCoords = document.getElementById('fileCoords');
  const rankCoords = document.getElementById('rankCoords');
  
  fileCoords.innerHTML = FILES.map(f => `<span>${f}</span>`).join('');
  rankCoords.innerHTML = RANKS.map(r => `<span>${r}</span>`).join('');
}

function renderBoard() {
  const board = document.getElementById('chessBoard');
  board.innerHTML = '';
  
  RANKS.forEach((rank, rankIdx) => {
    FILES.forEach((file, fileIdx) => {
      const square = document.createElement('div');
      const isLight = (rankIdx + fileIdx) % 2 === 0;
      const squareId = file + rank;
      
      square.className = `square ${isLight ? 'light' : 'dark'}`;
      square.dataset.square = squareId;
      
      // Add coordinate labels on edge squares
      if (showCoordinates) {
        if (fileIdx === 7) {
          const rankLabel = document.createElement('span');
          rankLabel.className = 'square-label rank';
          rankLabel.textContent = rank;
          square.appendChild(rankLabel);
        }
        if (rankIdx === 7) {
          const fileLabel = document.createElement('span');
          fileLabel.className = 'square-label file';
          fileLabel.textContent = file;
          square.appendChild(fileLabel);
        }
      }
      
      // Add piece if exists
      if (currentPosition[squareId]) {
        const piece = document.createElement('div');
        piece.className = 'piece';
        piece.textContent = PIECES[currentPosition[squareId]];
        piece.draggable = true;
        square.appendChild(piece);
      }
      
      square.addEventListener('click', handleSquareClick);
      square.addEventListener('dragstart', handleDragStart);
      square.addEventListener('dragover', handleDragOver);
      square.addEventListener('drop', handleDrop);
      
      board.appendChild(square);
    });
  });
  
  highlightLastMove();
}

function highlightLastMove() {
  if (moveHistory.length > 0 && highlightEnabled) {
    const lastMove = moveHistory[moveHistory.length - 1];
    const fromSquare = document.querySelector(`[data-square="${lastMove.from}"]`);
    const toSquare = document.querySelector(`[data-square="${lastMove.to}"]`);
    
    if (fromSquare) fromSquare.classList.add('last-move');
    if (toSquare) toSquare.classList.add('last-move');
  }
}

// ==================== PUZZLE MANAGEMENT ====================
function loadPuzzle(index) {
  if (index < 0 || index >= PUZZLES.length) return;
  
  currentPuzzleIndex = index;
  const puzzle = PUZZLES[index];
  
  // Reset state
  currentPosition = { ...puzzle.position };
  selectedSquare = null;
  moveHistory = [];
  solutionIndex = 0;
  hintsUsed = 0;
  elapsedTime = 0;
  
  // Update UI
  document.getElementById('puzzleTitle').textContent = puzzle.title;
  document.getElementById('difficultyText').textContent = 
    puzzle.difficulty.charAt(0).toUpperCase() + puzzle.difficulty.slice(1);
  document.getElementById('difficultyBadge').className = `difficulty-badge ${puzzle.difficulty}`;
  document.getElementById('puzzleRating').textContent = puzzle.rating;
  document.getElementById('currentPuzzleNumber').textContent = index + 1;
  document.getElementById('totalPuzzles').textContent = PUZZLES.length;
  document.getElementById('totalMoves').textContent = puzzle.solution.length;
  document.getElementById('currentMove').textContent = 0;
  
  // Render tags
  const tagsContainer = document.getElementById('puzzleTags');
  tagsContainer.innerHTML = puzzle.tags.map(tag => 
    `<span class="tag ${tag}">${tag.replace('-', ' ')}</span>`
  ).join('');
  
  // Update solution panel
  document.getElementById('solutionMoves').textContent = puzzle.solution.join(', ');
  document.getElementById('solutionExplanation').textContent = puzzle.explanation;
  document.getElementById('solutionPanel').classList.remove('visible');
  
  renderBoard();
  startTimer();
  updateMovesDisplay();
}

function nextPuzzle() {
  closeModal();
  if (currentPuzzleIndex < PUZZLES.length - 1) {
    loadPuzzle(currentPuzzleIndex + 1);
  } else {
    showFeedback('Uko≈Ñczy≈Çe≈õ wszystkie zadania! üéâ', 'success');
    loadPuzzle(0);
  }
}

function previousPuzzle() {
  if (currentPuzzleIndex > 0) {
    loadPuzzle(currentPuzzleIndex - 1);
  }
}

function resetPuzzle() {
  loadPuzzle(currentPuzzleIndex);
  showFeedback('Zadanie zresetowane', 'info');
}

// ==================== MOVE HANDLING ====================
function handleSquareClick(e) {
  const square = e.currentTarget;
  const squareId = square.dataset.square;
  
  if (selectedSquare) {
    attemptMove(selectedSquare, squareId);
    clearSelection();
  } else if (currentPosition[squareId]) {
    selectSquare(squareId);
  }
}

function selectSquare(squareId) {
  clearSelection();
  selectedSquare = squareId;
  
  const square = document.querySelector(`[data-square="${squareId}"]`);
  if (square) {
    square.classList.add('selected');
    if (highlightEnabled) {
      showLegalMoves(squareId);
    }
  }
}

function clearSelection() {
  document.querySelectorAll('.square').forEach(sq => {
    sq.classList.remove('selected', 'legal-move', 'legal-capture');
  });
  selectedSquare = null;
}

function showLegalMoves(from) {
  const piece = currentPosition[from];
  if (!piece) return;
  
  // Simplified: just show current solution move if it matches
  const puzzle = PUZZLES[currentPuzzleIndex];
  if (solutionIndex < puzzle.solution.length) {
    const expectedMove = puzzle.solution[solutionIndex];
    const to = expectedMove.slice(-2);
    
    if (expectedMove.includes(from) || guessFromSquare(expectedMove, from)) {
      const toSquare = document.querySelector(`[data-square="${to}"]`);
      if (toSquare) {
        if (currentPosition[to]) {
          toSquare.classList.add('legal-capture');
        } else {
          toSquare.classList.add('legal-move');
        }
      }
    }
  }
}

function guessFromSquare(notation, square) {
  // Simple heuristic: if notation starts with piece letter (Q, R, N, B, K)
  // and square contains that piece, it might be the from square
  const piece = currentPosition[square];
  if (!piece) return false;
  
  const pieceType = piece.charAt(1);
  return notation.charAt(0) === pieceType;
}

function attemptMove(from, to) {
  const puzzle = PUZZLES[currentPuzzleIndex];
  const expectedMove = puzzle.solution[solutionIndex];
  
  // Check if move matches expected solution
  if (moveMatches(from, to, expectedMove)) {
    makeMove(from, to);
    solutionIndex++;
    
    userStats.totalAttempts++;
    
    if (solutionIndex >= puzzle.solution.length) {
      // Puzzle solved!
      setTimeout(() => puzzleSolved(), 500);
    } else {
      showFeedback('≈öwietny ruch! ‚úì', 'success');
      playSound('move');
      updateMovesDisplay();
      
      // Make computer response if needed
      setTimeout(makeComputerMove, 800);
    }
  } else {
    // Wrong move
    showFeedback('Nieprawid≈Çowy ruch. Spr√≥buj ponownie!', 'error');
    playSound('error');
    animateError();
    userStats.totalAttempts++;
  }
}

function moveMatches(from, to, notation) {
  // Simple matching: check if 'to' square matches last 2 chars of notation
  const targetSquare = notation.slice(-2);
  if (to !== targetSquare) return false;
  
  // Additional check: piece on 'from' should match notation
  const piece = currentPosition[from];
  if (!piece) return false;
  
  const pieceType = piece.charAt(1);
  
  // If notation starts with piece letter, it should match
  if (/[QRNBK]/.test(notation.charAt(0))) {
    return notation.charAt(0) === pieceType;
  }
  
  // For pawn moves (lowercase or no piece indicator)
  return pieceType === 'P' || notation.length === 2;
}

function makeMove(from, to) {
  const piece = currentPosition[from];
  const capture = currentPosition[to];
  
  moveHistory.push({ from, to, piece, capture });
  
  currentPosition[to] = piece;
  delete currentPosition[from];
  
  renderBoard();
  updateMovesHistory();
}

function makeComputerMove() {
  const puzzle = PUZZLES[currentPuzzleIndex];
  
  // In a real implementation, this would be the opponent's response
  // For simplicity, we'll skip computer moves in this version
  // as most puzzles are "find the winning move" type
}

function undoMove() {
  if (moveHistory.length === 0) return;
  
  const lastMove = moveHistory.pop();
  currentPosition[lastMove.from] = lastMove.piece;
  
  if (lastMove.capture) {
    currentPosition[lastMove.to] = lastMove.capture;
  } else {
    delete currentPosition[lastMove.to];
  }
  
  if (solutionIndex > 0) solutionIndex--;
  
  renderBoard();
  updateMovesHistory();
  updateMovesDisplay();
  showFeedback('Ruch cofniƒôty', 'info');
}

// ==================== DRAG AND DROP ====================
function handleDragStart(e) {
  const square = e.target.closest('.square');
  if (square) {
    selectedSquare = square.dataset.square;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', selectedSquare);
    e.target.classList.add('dragging');
  }
}

function handleDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
}

function handleDrop(e) {
  e.preventDefault();
  const from = e.dataTransfer.getData('text/plain');
  const toSquare = e.target.closest('.square');
  
  if (toSquare && from) {
    const to = toSquare.dataset.square;
    attemptMove(from, to);
  }
  
  document.querySelectorAll('.dragging').forEach(el => {
    el.classList.remove('dragging');
  });
  
  clearSelection();
}

// ==================== PUZZLE COMPLETION ====================
function puzzleSolved() {
  stopTimer();
  
  const puzzle = PUZZLES[currentPuzzleIndex];
  const timeBonus = Math.max(0, 60 - Math.floor(elapsedTime));
  const hintPenalty = hintsUsed * 10;
  const ratingChange = Math.max(5, Math.min(20, 15 + timeBonus - hintPenalty));
  
  // Update stats
  userStats.totalSolved++;
  userStats.todaysSolved++;
  userStats.currentStreak++;
  userStats.rating += ratingChange;
  
  if (userStats.currentStreak > userStats.bestStreak) {
    userStats.bestStreak = userStats.currentStreak;
  }
  
  // Calculate accuracy
  userStats.accuracyPercent = Math.round(
    (userStats.totalSolved / Math.max(1, userStats.totalAttempts)) * 100
  );
  
  // Update average time
  const totalTime = (userStats.averageTime * (userStats.totalSolved - 1) + elapsedTime) / userStats.totalSolved;
  userStats.averageTime = totalTime;
  
  checkAchievements();
  saveStats();
  updateStatsDisplay();
  
  // Show success modal
  document.getElementById('modalTime').textContent = formatTime(elapsedTime);
  document.getElementById('modalMoves').textContent = moveHistory.length;
  document.getElementById('modalRating').textContent = `+${ratingChange}`;
  document.getElementById('successModal').classList.add('visible');
  
  playSound('success');
  createConfetti();
  
  if (autoNextEnabled) {
    setTimeout(() => {
      nextPuzzle();
    }, 3000);
  }
}

function checkAchievements() {
  const achievements = [
    { id: 1, condition: userStats.totalSolved >= 1, name: 'PoczƒÖtek' },
    { id: 2, condition: userStats.totalSolved >= 10, name: 'Amator' },
    { id: 3, condition: userStats.totalSolved >= 50, name: 'Pasjonat' },
    { id: 4, condition: userStats.totalSolved >= 100, name: 'Mistrz' },
    { id: 5, condition: userStats.currentStreak >= 10, name: 'Nieustƒôpliwy' },
    { id: 6, condition: userStats.accuracyPercent >= 95, name: 'Perfekcja' }
        
